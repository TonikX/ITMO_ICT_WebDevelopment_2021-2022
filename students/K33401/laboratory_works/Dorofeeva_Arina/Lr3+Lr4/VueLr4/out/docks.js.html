<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: docks.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: docks.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import axios from "axios";

/**
 * Делает POST запрос на сервер запрашивая токен авторизации.
 * Поле authData имеет следующий вид
 * {
 * username: string,
 * password: string
 * }
 * В ответе ожидает токен, который сохраняется в
 * localstorig
 * А также записывает токен в поле token состояения приложения
 * После чего редиректит в личный кабинет.
 *
 * В случае неудачной попытки запроса, ожидает responseError,
 * которой сохраняется в loginError, для дальнейшего вывода в виде особщения
 * пользователю
 *
 * @param {object} state - локальное состояние приложения
 * @param {object} authData - данные пользователя
 * @login
 */

function login(state, authData) {

    const config = {
        headers: {
            "Content-Type": 'application/json'
        }
    }
    const {username, password} = authData;
    const body = JSON.stringify({username, password});


    axios.post(URL + '/auth/token/login/', body, config).then(res => {
        localStorage.setItem("token", res.data.auth_token);
        state.token = res.data.auth_token
        router.push({
            path: '/cabinet',
        });
    }).catch(err => {
        state.loginError = err.response.data
    })
}


/**
 * Делает Post запрос на сервер для регистрации пользователя
 * Поле authData имеет следующий вид
 * {
 * username: string,
 * password: string
 * }
 * В случае неудачной попытки запроса, ожидает responseError,
 * которой сохраняется в registrationError, для дальнейшего вывода в виде особщения
 * пользователю
 *
 * @param {object} state - локальное состояние приложения
 * @param {object} authData - данные пользователя
 * @registerUser
 */
function registerUser(state, authData) {

    const config = {
        headers: {
            "Content-Type": 'application/json'
        }
    }
    axios.post(URL + `/auth/users/`, authData, config).then(res => {
        router.push({
            path: "/sign-in"
        })
    }).catch(err => {
        state.registrationError = err.response.data
    })
}


/**
 * Делает DELETE запрос видео пользователя на сервер.
 * Поле data имеет следующий вид
 * {
 * id: string,
 * }
 * В случае успешноого ответа удаляет по id видео из локального состояния
 *
 *
 * @param {object} state - локальное состояние приложения
 * @param {object} data - Данные видео
 *
 * @removeVideo
 */
function removeVideo(state, data) {
    const token = state.token || localStorage.getItem('token');
    const config = tokenConfig(token)
    axios.delete(URL + `/api/videos-of-user/${data.id}`, config).then(res => {
        state.videosOfUser = state.videosOfUser.filter(video => video.id !== data.id)
    }).catch(err => {
        console.log(err)
    })
}


/**
 * Делает GET запрос видео пользователя на сервер.
 *
 * в ответе ожидается
 * {
 * id: string | number,
 * tags: string,
 * link: string
 * }
 *
 * В случае успешноого ответа сохраняет видео в локальное состояние - videosOfUser
 *
 * @param {object} state - локальное состояние приложения
 *
 * @getVideosOFUser
 */
function getVideosOFUser(state) {
    const token = localStorage.getItem('token');
    const config = tokenConfig(token)
    axios.get(URL + `/api/videos-of-user/?owner=${state.userData.id}`, config).then(res => {
        state.videosOfUser = res.data;
    }).catch(err => {
        console.log(err)
    })
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#getVideosOFUser">getVideosOFUser</a></li><li><a href="global.html#login">login</a></li><li><a href="global.html#registerUser">registerUser</a></li><li><a href="global.html#removeVideo">removeVideo</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Thu Dec 30 2021 16:28:56 GMT+0300 (Moscow Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
